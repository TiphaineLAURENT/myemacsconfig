/*
** ETNA PROJECT, 29/10/2018 by lafont_a
** my_str_to_wordtab
** File description:
**      DAY06 ex7
*/

#include <stdlib.h>
#include <stdio.h>
#include <memory.h>

char **my_str_to_wordtab(char *str);
char **build_final_tab(int nbw, char *str);
int is_alphanumeric(char str);
int nb_words(char *str);
int *tab_len_words(char *str, int index, int count);

char **my_str_to_wordtab(char *str)
{
    int nbw = nb_words(str);
    char **final = build_final_tab(nbw, str);
    int i = 0;
    int index = 0;
    int mot = 0;

    while (str[i] != '\0') {
        if (is_alphanumeric(str[i]) == 1) {
            final[mot][index] = str[i];
            index++;
            if (is_alphanumeric(str[i + 1]) == 0)
                mot++;
        } else
            if (is_alphanumeric(str[i]) == 0 && is_alphanumeric(str[i + 1]) == 1)
                index = 0;

        i++;
    }

    final[nbw] = NULL;
    return (final);
}

char **build_final_tab(int nbw, char *str)
{
    char **tab_final = malloc(sizeof(char *) * (nbw + 1));
    int *tab = tab_len_words(str,0,0);

    for (int i = 0 ; i < nbw ; i++) {
        tab_final[i] = malloc(sizeof(char) * (tab[i] + 1));
    }
    free(tab);
    return (tab_final);
}

int *tab_len_words(char *str, int index, int count)
{
    int nbw = nb_words(str);
    int *tab = malloc(sizeof(int) * (nbw + 1));
    int i = 0;

    if (count == 0 && is_alphanumeric(str[0]) && is_alphanumeric(str[1]) == 0)
        count++;
    while (str[i] != '\0') {
        if (is_alphanumeric(str[i]) == 1) {
            count++;
        } else {
            if (is_alphanumeric(str[i - 1]) == 1) {
                tab[index] = count;
                count = 0;
                index++;
            }
        }
        i++;
    }
    if (index != nbw)
        tab[index - 1] = count;
    return (tab);
}

int nb_words(char *str)
{
    int i = 0;
    int count = 0;

    if (count == 0 && is_alphanumeric(str[0]))
        count++;
    while (str[i] != '\0') {
        if (is_alphanumeric(str[i]) == 0 && is_alphanumeric(str[i + 1])) {
            count++;
        }
        i++;
    }
    return (count);
}

int is_alphanumeric(char str)
{

    if ((str >= 97 && str <= 122) || (str >= 65 && str <= 90) || (str >= 48 && str <= 57)) {
        return (1);
    } else {
        return (0);
    }
}
